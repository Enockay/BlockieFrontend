<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Celebrate 1 year with Blackie Networks! Rate our services and win exciting prizes. Learn more about who we are and our commitment to quality connectivity.">
  <title>Blackie Networks - Promotions</title>
  <link rel="stylesheet" href="tailwind.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            gradient: 'gradient 5s ease infinite',
            bounceSlow: 'bounce 3s infinite',
          },
          keyframes: {
            gradient: {
              '0%, 100%': { backgroundPosition: '0% 50%' },
              '50%': { backgroundPosition: '100% 50%' },
            },
          },
        },
      },
    };
  </script>
</head>

<body class="bg-gradient-to-br from-pink-200 via-purple-300 to-indigo-400 animate-gradient text-gray-800">

  <header
    class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white py-6 shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-4">
      <!-- Title -->
      <p class="text-xm md:text-2xl font-extrabold animate-bounceSlow">🎉 Blackie Networks</p>

      <!-- Navigation and Button Container -->
      <div class="flex items-center space-x-4">
        <!-- Navigation Links -->
        <nav class="hidden md:flex space-x-4 text-sm">
          <a href="#promotions" class="hover:underline">Promotions</a>
          <a href="#winners" class="hover:underline">Winners</a>
        </nav>

        <!-- Button for Login -->
        <a href="login.html">
          <button
            class="bg-yellow-500 text-black font-bold py-2 px-4 rounded-lg hover:bg-yellow-400 transition duration-300">
            Go Back to Login
          </button>
        </a>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu"
      class="md:hidden hidden bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white p-4">
      <nav>
        <ul class="space-y-4 text-center text-sm">
          <li><a href="#promotions" class="hover:underline">Promotions</a></li>
          <li><a href="#winners" class="hover:underline">Winners</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <script>
    function toggleMobileMenu() {
      const menu = document.getElementById("mobile-menu");
      menu.classList.toggle("hidden");
    }
  </script>



  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-purple-500 via-indigo-600 to-blue-500 text-white py-16">
    <div class="max-w-4xl mx-auto text-center">
      <h1 class="text-xl md:text-xl font-bold md:mb-4 mb-1">🎉 Celebrating 1 Year of Excellence!</h1>
      <p class="text-lg mb-6">Join us in celebrating our anniversary with exciting prizes and offers. Rate us and win
        big!</p>
      <a href="#promotions"
        class="bg-white text-indigo-600 font-bold px-6 py-3 rounded-lg hover:bg-indigo-100 transition shadow-lg">
        View Promotions
      </a>
    </div>
  </section>

  <!-- Winners Display Section -->
  <div class="flex justify-center items-center w-full mt-4">
    <section id="winners-display"
      class="max-w-4xl bg-gradient-to-r from-yellow-50 to-pink-50 shadow-lg rounded-2xl md:p-6 p-4 border border-pink-200 mb-12 text-center">
      <h2 class="md:text-2xl text-xl font-extrabold text-pink-800 mb-6">🎉 Recent winners 🎉</h2>
      <div id="winner-card"
        class="hidden animate-bounce bg-white md:p-6  p-2 rounded-xl shadow-lg border border-gray-200 text-gray-800">
        <h3 id="winner-name" class="md:text-2xl text-xl text-purple-800 font-bold"></h3>
        <p id="winner-package" class="text-lg"></p>
        <p id="winner-time" class="text-sm text-gray-600"></p>
      </div>
    </section>
  </div>

  <div class="text-red-500 font-bold ">
    <input id="identity" class="p-1 text-center rounded-lg" type="hidden" name="routerMac" value="$(identity)" disabled>
    <input id="ip" class="p-1 text-center rounded-lg" type="hidden" name="ip" value="$(ip)" disabled>
    <input id="mac" class="p-1 text-center rounded-lg" type="hidden" name="Mac" value="$(mac)" disabled>
  </div>



  <!-- Main Content -->
  <main class="max-w-5xl mx-auto p-4">
    <!-- About Section -->
    <section id="about" class="mb-12">
      <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Who We Are</h2>
        <p class="text-gray-600 mt-2">Your trusted partner for reliable, high-speed internet solutions.</p>
      </div>
      <p class="text-gray-700 text-base leading-relaxed">
        Established in 2023, Blackie Networks has quickly become a leading provider in our community. From individual
        users to businesses, we tailor packages to ensure maximum value for money. Join us today and experience the
        difference!
      </p>
    </section>

    <!-- Promotions Section -->
    <section id="promotions" class="bg-white shadow rounded-lg p-6 border border-gray-200 mb-12">
      <h2 class="text-xl md:text-3xl font-bold text-gray-800 mb-4 text-center">Celebrate with Exciting Promotions</h2>
      <p class="text-gray-600 mb-6 text-center">Win prizes by rating us and purchasing packages!</p>

      <!-- phoneNumbers for draw -->
      <div class="bg-gradient-to-br from-blue-200 via-indigo-300 to-purple-300 shadow-inner rounded-lg p-6 mb-8">
        <h3 class="md:text-2xl text-xl font-semibold mb-4">Enter the Draw & Win!</h3>
        <p class="text-gray-700 text-sm mb-4">
          Dial <strong>*100*5*2*5*1#</strong>, then enter your phone number below. You'll receive a confirmation SMS
          with a Free <strong>3-hours voucher</strong> and more prize details! Only applied in One device one
          phoneNumber.
        </p>
        <div class="flex gap-2">
          <form id="draw-form" class="flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4">
            <input type="tel" id="phoneNumber" placeholder="Enter your phone number"
              class="w-full md:w-auto flex-1 border border-gray-400 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
              required>
          </form>
          <button onclick="submitPhoneNumber()"
            class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition shadow-lg">
            Submit
          </button>
        </div>
        <!-- Spinner (Hidden by Default) -->
        <div id="spinner1" class="flex justify-center items-center hidden">
          <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
        <p class="" id="feedback-message"></p>
        <p class="text-sm text-red-600 mt-3 font-semibold">
          <strong>NB:</strong> No SMS? You may have missed a step. Try again.
        </p>
      </div>


      <!--promotions-->
      <div id="promotions-list" class="space-y-4 mb-4">
        <div class="promotion-item bg-gray-100 p-3 rounded shadow border border-gray-300">
          <h3 class="text-lg font-semibold">🎉 Hourly Package Winners</h3>
          <p class="text-sm text-gray-700">Win internet vouchers from 30 minutes to 7 days—selected hourly! ⏳✨</p>
        </div>
        <div class="promotion-item bg-gray-100 p-3 rounded shadow border border-gray-300">
          <h3 class="text-lg font-semibold">🏆 Weekly Top Buyer</h3>
          <p class="text-sm text-gray-700">Be the top buyer of the week and win KES 500 cash! 💵💫</p>
        </div>
        <div class="promotion-item bg-gray-100 p-3 rounded shadow border border-gray-300">
          <h3 class="text-lg font-semibold">🥈 Second Prize</h3>
          <p class="text-sm text-gray-700">Enjoy a tasty lunch worth KES 200 as our thanks! 🍴✨</p>
        </div>
        <div class="promotion-item bg-gray-100 p-3 rounded shadow border border-gray-300">
          <h3 class="text-lg font-semibold">🥉 Third Prize</h3>
          <p class="text-sm text-gray-700">Celebrate with lunch worth KES 100—cheers to you! 🎊🍴</p>
        </div>
        <div class="promotion-item bg-gray-100 p-3 rounded shadow border border-gray-300">
          <h3 class="text-lg font-semibold">🎁 Special Bonus</h3>
          <p class="text-sm text-gray-700">Win surprise prizes for staying active—keep it up! 🎉🎈</p>
        </div>
      </div>

      <!-- Rating Section -->
      <div class="bg-gradient-to-br from-pink-200 via-purple-300 to-indigo-300 shadow-inner rounded-lg p-6 mb-8">
        <h3 class="text-2xl font-semibold mb-4">Rate Us and Win</h3>
        <p class="text-gray-700 text-base mb-4">Rate our services and stand a chance to win exciting prizes!</p>

        <div id="rating-stars" class="flex justify-center space-x-2 mb-4">
          <!-- Dynamic star rendering -->
          <span class="text-3xl cursor-pointer text-gray-400 hover:text-yellow-500" onclick="setRating(1)">★</span>
          <span class="text-3xl cursor-pointer text-gray-400 hover:text-yellow-500" onclick="setRating(2)">★</span>
          <span class="text-3xl cursor-pointer text-gray-400 hover:text-yellow-500" onclick="setRating(3)">★</span>
          <span class="text-3xl cursor-pointer text-gray-400 hover:text-yellow-500" onclick="setRating(4)">★</span>
          <span class="text-3xl cursor-pointer text-gray-400 hover:text-yellow-500" onclick="setRating(5)">★</span>
        </div>

        <button id="submit-rating" type="button"
          class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition shadow-lg">
          Submit Rating
        </button>

        <p id="rating-message" class="text-sm text-gray-500 mt-3"></p>
      </div>

      <!-- Modal -->
      <div id="phoneModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg w-96">
          <h2 class="text-xl font-semibold mb-1">Enter Your Phone Number</h2>
          <p class="text-sm font-semibold mb-2 ">Make sure you have followed this step <strong> *100*5*2*5*1# </strong>
            to get the your Voucher.
          </p>
          <input type="tel" id="rating-phoneNumber" class="border p-2 w-full rounded mb-4" placeholder="Enter phone number">
          <!-- Spinner (Hidden by Default) -->
          <div id="rating-spinner" class="flex justify-center items-center hidden">
            <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
          </div>
          <div class="flex justify-end">
            <button onclick="closeModal()"
              class="mr-2 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
            <button id="submit-phone"
              class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Submit</button>
          </div>
        </div>
      </div>
    </section>



  </main>

  <!-- Footer -->
  <footer id="contact" class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white py-6">
    <div class="max-w-6xl mx-auto text-center">
      <p class="text-sm">Contact us: <a href="mailto:support@blackienetworks.com"
          class="underline">support@blackienetworks.com</a> | +254 700 000 000</p>
      <p class="text-sm mt-4">&copy; 2025 Blackie Networks. All rights reserved.</p>
    </div>
  </footer>

  <!-- Dynamic Scripts for Stars -->
  <script>
    let selectedRating = 0;
    function setRating(rating) {
      selectedRating = rating;
      const stars = document.querySelectorAll("#rating-stars span");
      stars.forEach((star, index) => {
        star.style.color = index < rating ? "gold" : "gray";
      });
      document.getElementById("rating-message").textContent = "";
    }

    function openModal() {
      if (selectedRating === 0) {
        document.getElementById("rating-message").textContent = "❌ Please select a rating!";
        document.getElementById("rating-message").classList.add("text-red-600");
        return;
      }
      document.getElementById("phoneModal").classList.remove("hidden");
    }

    function closeModal() {
      document.getElementById("phoneModal").classList.add("hidden");
    }

    document.getElementById("submit-rating").addEventListener("click", openModal);

    document.getElementById("submit-phone").addEventListener("click", async () => {
      const phoneNumber = document.getElementById("rating-phoneNumber").value.trim();
      const messageElement = document.getElementById("rating-message");
      const spinner = document.getElementById('rating-spinner');

      if (!phoneNumber) {
        messageElement.textContent = "⚠️ Please enter your phone number to receive the gift.";
        messageElement.classList.add("text-yellow-600");
        return;
      }
         // Show the spinner
      spinner.classList.remove('hidden');

      const routerHost = document.getElementById("identity")?.value || "Unknown Router";
      const ipAddress = document.getElementById("ip")?.value || "Unknown IP";
      const macAddress = document.getElementById("mac")?.value || "Unknown mac";

      const requestData = {
        macAddress,
        ipAddress,
        routerHost,
        rating: selectedRating,
        phoneNumber,
      };

      try {
        const response = await fetch("https://node-blackie-networks.fly.dev/draw/submit-rating", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestData),
        });

        const data = await response.json();

        if (data.success) {
          messageElement.textContent = `✅ ${data.message}`;
          messageElement.classList.remove("text-red-600", "text-yellow-600");
          messageElement.classList.add("text-green-600");
          spinner.classList.add('hidden');
          closeModal();
        } else {
          messageElement.textContent = `${data.message}`;
          messageElement.classList.add("text-red-600");
          spinner.classList.add('hidden');
          closeModal();
        }
      } catch (error) {
        messageElement.textContent = "❌ Something went wrong. Please try again.";
        messageElement.classList.add("text-red-600");
        spinner.classList.add('hidden');
        closeModal();
      }
    });


    async function submitPhoneNumber() {
      const spinner = document.getElementById('spinner1');
      const phoneNumber = document.getElementById("phoneNumber").value.trim();
      const messageElement = document.getElementById("feedback-message");

      if (!phoneNumber) {
        messageElement.textContent = "⚠️ Please enter your phone number to enter the draw";
        messageElement.classList = "text-yellow-600 p-2 mt-2 bg-white";
        return;
      }
      // Show the spinner
      spinner.classList.remove('hidden');

      const routerHost = document.getElementById("identity")?.value || "Unknown Router";
      const ipAddress = document.getElementById("ip")?.value || "Unknown IP";
      const macAddress = document.getElementById("mac")?.value || "Unknown mac";

      const requestData = {
        macAddress,
        ipAddress,
        routerHost,
        rating: selectedRating,
        phoneNumber,
      };

      try {
        const response = await fetch("https://node-blackie-networks.fly.dev/draw/enter-draw", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestData),
        });

        const data = await response.json();

        if (data.success) {
          messageElement.textContent = `✅ ${data.message}`;
          messageElement.classList.remove("text-red-600", "text-yellow-600");
          messageElement.classList = "text-green-600 mt-2 text-center bg-white p-2 ";
          spinner.classList.add('hidden'); // Hide spinner after process
          closeModal();
        } else {
          messageElement.textContent = `${data.message}`;
          messageElement.classList = "text-red-600 text-center bg-white mt-2 p-2 ";
          spinner.classList.add('hidden');
          closeModal();
        }
      } catch (error) {
        messageElement.textContent = `${error}`;
        messageElement.classList = "text-red-600 p-2 text-center mt-2 bg-white";
        spinner.classList.add('hidden'); // Hide spinner after process
        closeModal();
      }
    }

    const winners = [];

// Fetch Winners Data from Server
async function fetchWinners() {
  try {
    const response = await fetch("https://node-blackie-networks.fly.dev/draw/weekly-winners");

    if (!response.ok) throw new Error("Failed to fetch winners data.");

    const data = await response.json();
    console.log(data);

    // Clear and update global winners array
    winners.length = 0;
    winners.push(...data.winners);

    return winners;
  } catch (error) {
    console.error(error);
    return [];
  }
}

// Display Winners Briefly
async function displayWinners() {
  const winnerCard = document.getElementById("winner-card");
  const winnerName = document.getElementById("winner-name");
  const winnerPackage = document.getElementById("winner-package");

  const fetchedWinners = await fetchWinners();
  
  if (fetchedWinners.length === 0) {
    winnerName.textContent = "No winners yet! Be our first!";
    winnerPackage.textContent = "";
    winnerCard.classList.remove("hidden");
    return;
  }

  let index = 0;
  
  function showNextWinner() {
    if (fetchedWinners.length === 0) return;

    const { phoneNumber, prizesWon } = fetchedWinners[index];

    // Use the latest prize won
    const latestPrize = prizesWon.length > 0 ? prizesWon[prizesWon.length - 1].prize : "No prize listed";

    winnerName.textContent = `Winner: ${phoneNumber}`;
    winnerPackage.textContent = `Prize: ${latestPrize}`;

    winnerCard.classList.remove("hidden");

    setTimeout(() => {
      winnerCard.classList.add("hidden");
      index = (index + 1) % fetchedWinners.length;
    }, 2500);
  }

  showNextWinner();
  setInterval(showNextWinner, 3000); // Rotate winners every 3s
}

// Call displayWinners after DOM is loaded
document.addEventListener("DOMContentLoaded", displayWinners);

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("draw-form");
      const userNumberInput = document.getElementById("user-number");
      const feedbackDiv = document.getElementById("feedback-message");

      const routerHost = document.getElementById("identity").value;
      const ipAddress = document.getElementById("ip").value;
      const macAddress = document.getElementById("mac").value;

      form.addEventListener("submit", async function (event) {
        event.preventDefault();
        feedbackDiv.textContent = ""; // Clear previous messages
        feedbackDiv.className = ""; // Reset styles

        const phoneNumber = userNumberInput.value.trim();

        // Validate phone number (Kenyan format)
        const phoneRegex = /^(?:\+254|0)[17]\d{8}$/;
        if (!phoneRegex.test(phoneNumber)) {
          showFeedback("Please enter a valid Kenyan phone number (07XXXXXXXX or +2547XXXXXXXX)", "error");
          return;
        }

        try {
          const response = await fetch("https://node-blackie-networks.fly.dev/draw/enter-draw", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ phoneNumber, ipAddress, routerHost, macAddress })
          });

          const result = await response.json();

          if (response.ok) {
            showFeedback("Success! Check your SMS for the voucher.", "success");
            userNumberInput.value = ""; // Clear input field
          } else {
            showFeedback(result.message || "Something went wrong. Try again.", "error");
          }
        } catch (error) {
          console.error("Request failed:", error);
          showFeedback("Network error. Please try again later.", "error");
        }
      });

      function showFeedback(message, type) {
        feedbackDiv.textContent = message;
        feedbackDiv.className = type === "success"
          ? "text-green-600 font-semibold mt-3 p-3 bg-white"
          : "text-red-600 font-semibold mt-3 p-3  bg-white";
      }
    });


  </script>
</body>

</html>